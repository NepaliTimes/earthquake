import*as t from"https://cdn.skypack.dev/three@0.129.0/build/three.module.js";import{GLTFLoader as et}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/loaders/GLTFLoader.js";import{gsap as i}from"https://cdn.skypack.dev/gsap";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))g(r);new MutationObserver(r=>{for(const y of r)if(y.type==="childList")for(const C of y.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&g(C)}).observe(document,{childList:!0,subtree:!0});function x(r){const y={};return r.integrity&&(y.integrity=r.integrity),r.referrerPolicy&&(y.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?y.credentials="include":r.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function g(r){if(r.ep)return;r.ep=!0;const y=x(r);fetch(r.href,y)}})();window.onbeforeunload=function(){window.scrollTo(0,0)};const P=new t.PerspectiveCamera(10,window.innerWidth/window.innerHeight,.1,1e3);P.position.z=13;let v=document.getElementById("ending"),G=document.getElementById("logo");v.style.visibility="hidden";G.style.visibility="hidden";let k=!1;function ot(){v.style.visibility=="visible"&&function e(){(v.style.opacity-=.05)<0?(v.style.visibility="hidden",G.style.visibility="hidden"):requestAnimationFrame(e)}(),k=!1}function nt(){v.style.visibility=="hidden"&&function e(){var s=parseFloat(v.style.opacity);(s+=.05)>1||(v.style.opacity=s,requestAnimationFrame(e),v.style.visibility="visible",G.style.visibility="visible")}(),k=!0}let n=0,R=0,M={x:0,y:-.3,z:4},O={x:.3,y:3.14},m=-2,u=4;const A=new t.Scene;let d;const it=new et;let W=!1;const c=document.getElementById("vidA"),U=new t.VideoTexture(c),st=document.getElementById("imga"),lt=new t.TextureLoader().load(st.src,()=>{t.Cache.clear()}),at=document.getElementById("imgb"),rt=new t.TextureLoader().load(at.src,()=>{t.Cache.clear()}),dt=document.getElementById("imgc"),yt=new t.TextureLoader().load(dt.src,()=>{t.Cache.clear()}),ct=document.getElementById("imgd"),pt=new t.TextureLoader().load(ct.src,()=>{t.Cache.clear()}),ut=document.getElementById("imge"),mt=new t.TextureLoader().load(ut.src,()=>{t.Cache.clear()}),ft=document.getElementById("imgf"),gt=new t.TextureLoader().load(ft.src,()=>{t.Cache.clear()}),wt=document.getElementById("imgg"),xt=new t.TextureLoader().load(wt.src,()=>{t.Cache.clear()}),ht=document.getElementById("imgh"),bt=new t.TextureLoader().load(ht.src,()=>{t.Cache.clear()}),Bt=document.getElementById("imgi"),Et=new t.TextureLoader().load(Bt.src,()=>{t.Cache.clear()}),Lt=document.getElementById("imgj"),zt=new t.TextureLoader().load(Lt.src,()=>{t.Cache.clear()}),Tt=document.getElementById("imgk"),It=new t.TextureLoader().load(Tt.src,()=>{t.Cache.clear()}),f=document.getElementById("text");console.log(f);f.style.display="none";f.style.top=0;const w=document.getElementById("text2");console.log(w);w.style.display="none";w.style.top=0;const h=document.getElementById("text3");h.style.display="none";h.style.top=0;const S=document.getElementById("text4");S.style.display="none";S.style.top=0;const b=document.getElementById("text5");b.style.display="none";b.style.top=0;const B=document.getElementById("text6");B.style.display="none";B.style.top=0;const E=document.getElementById("text7");E.style.display="none";E.style.top=0;const L=document.getElementById("text8");L.style.display="none";L.style.top=0;const z=document.getElementById("text9");z.style.display="none";z.style.top=0;const T=document.getElementById("text10");T.style.display="none";T.style.top=0;const I=document.getElementById("text11");I.style.display="none";I.style.top=0;c.addEventListener("loadeddata",()=>{c.play(),U.needsUpdate=!0});c.currentTime=10;function vt(e){const s=new t.Object3D;return s.scale.x=.5,s.scale.y=.5,s.scale.z=.5,s.rotation.y=e,s.position.z=u,s}function St(e,s){const x=new t.BoxGeometry(1,1,1);s.isTexture?(s.wrapS=t.RepeatWrapping,s.wrapT=t.RepeatWrapping):s.isVideoTexture&&(x.applyMatrix4(new t.Matrix4().makeScale(-1,1,1)),s.minFilter=t.LinearFilter,s.magFilter=t.LinearFilter,s.format=t.RGBFormat);const g=new t.MeshBasicMaterial({map:s,side:t.FrontSide,toneMapped:!1});console.log(g);const r=new t.Mesh(x,g);return console.log(r),r.position.x=2,r.position.y=e,r.scale.x=.01,r.scale.y=.2,r.scale.z=.4,r}const J=new t.BufferGeometry,K=1e3,Q=new Float32Array(K*3);for(let e=0;e<K*3;e++)Q[e]=(Math.random()-.5)*(Math.random()*5);J.setAttribute("position",new t.BufferAttribute(Q,3));const At=new t.PointsMaterial({size:.005,color:"gray",transparent:!0,blending:t.AdditiveBlending}),q=new t.Points(J,At),Ct=new t.FontLoader,Y=[],a=[],o=[],j=["11:56 25 April 2015","The Earthquake from Above","Langtang After 10 Years","Bhaktapur 2.0","Bungamati Builds Back","It Better Be Better Next Time","Loss of Soul and Soil","Structural Problems","Yes, Quakes can be Forecast","Disaster Journalism","Towering Monument to 2015"],Ft=[.23,.3,.3,.195,.28,.35,.27,.25,.35,.35,.35],Mt=[-2,-3.1,-4.2,-5.3,-6.4,-7.5,-8.6,-9.7,-10.8,-11.9,-13],Yt=[lt,rt,yt,pt,mt,gt,xt,bt,Et,zt,It];Ct.load("/earthquake/fonts/nueue.json",e=>{try{for(let s=0;s<j.length;s++){const x=new St(Mt[s],Yt[s]),g=new vt(s+1);g.add(x),A.add(g),a.push(x),o.push(g),o.length>0&&o[0]&&o[0].add(q),console.log("Cube:",x),console.log("parent:",g);const r=new t.TextGeometry(j[s],{font:e,size:.05,height:.001});r.computeBoundingBox();const y=r.boundingBox.max.x-r.boundingBox.min.x,C=new t.MeshBasicMaterial({color:"black"}),F=new t.Mesh(r,C);F.rotation.y=1.65,F.position.set(3-y/2,-.65,Ft[s]),F.scale.y=0,x.add(F),Y.push(F)}}catch(s){console.error("ðŸ’¥ Error in font loader loop:",s)}});let l=0;function X(){for(var e=0;e<11;e++)4.125<=o[e].rotation.y&&o[e].rotation.y<=5.5?(l=e,c.paused&&f.style.display=="none"&&w.style.display=="none"&&h.style.display=="none"&&S.style.display=="none"&&b.style.display=="none"&&B.style.display=="none"&&E.style.display=="none"&&L.style.display=="none"&&z.style.display=="none"&&T.style.display=="none"&&I.style.display=="none"?(i.to(a[e].scale,{y:.8,duration:.5}),i.to(a[e].scale,{z:1.3,duration:.5}),i.to(a[e].rotation,{y:0,duration:.5}),i.to(a[e].position,{z:0,duration:.5}),i.to(a[e].position,{x:2,duration:.5}),i.to(Y[e].scale,{y:2,duration:.5})):(i.to(a[e].scale,{y:1.4,duration:.5}),i.to(a[e].scale,{z:2,duration:.5}),i.to(a[e].rotation,{y:3.14,duration:.5}),i.to(a[e].position,{y:0,duration:.5}),i.to(a[e].position,{z:1,duration:.5}),i.to(a[e].position,{x:1,duration:.5}),i.to(Y[e].scale,{y:0,duration:.5})),W=!0):(o[e].rotation.y<4.125||o[e].rotation.y>5.5)&&(i.to(a[e].scale,{y:.2,duration:.5}),i.to(a[e].scale,{z:.4,duration:.5}),i.to(a[e].rotation,{y:0,duration:.5}),i.to(a[e].position,{z:0,duration:.5}),i.to(a[e].position,{x:2,duration:.5}),i.to(Y[e].scale,{y:0,duration:.5}));(o[l].rotation.y<4.125||o[l].rotation.y>5.5)&&(W=!1)}console.log(a[l]);it.load("/earthquake/assetA.glb",function(e){d=e.scene,d.position.x=M.x,d.position.z=M.z,d.position.y=M.y,d.rotation.y=O.y,d.rotation.x=O.x,d.scale.y=.04,d.scale.x=.04,d.scale.z=.04,A.add(d),t.Cache.clear()},function(e){},function(e){});const H=new t.WebGLRenderer({alpha:!0});H.setSize(window.innerWidth,window.innerHeight);document.getElementById("container3d").appendChild(H.domElement);const Pt=new t.AmbientLight(16777215,4);A.add(Pt);const Z=new t.DirectionalLight(8900346,5);Z.position.set(20,500,0);A.add(Z);const $=new t.DirectionalLight(16758465,3);$.position.set(0,200,0);A.add($);const kt=new t.Clock,tt=()=>{requestAnimationFrame(tt);const e=kt.getElapsedTime();q.rotation.y=-.1*e,q.rotation.x=-.1*e,c.readyState>=c.HAVE_CURRENT_DATA&&(U.needsUpdate=!0),H.render(A,P)};tt();window.addEventListener("resize",()=>{P.aspect=window.innerWidth/window.innerHeight,P.updateProjectionMatrix(),H.setSize(window.innerWidth,window.innerHeight)});const Ot=_.debounce(()=>{n=window.scrollY/document.body.clientHeight,d.rotation.y=O.y+-1.8*Math.PI*n,d.rotation.x=O.x+-.5*n,d.position.y=M.y+-.1*n,d.position.z=M.z+4*n,o[0].rotation.y=-.8+30*n,o[0].position.z=u+4*n,a[0].position.y=m+9.5*n,o[1].rotation.y=-3+30*n,o[1].position.z=u+4*n,a[1].position.y=m-.65+9.5*n,o[2].rotation.y=-5.2+30*n,o[2].position.z=u+4*n,a[2].position.y=m-1.3+9.5*n,o[3].rotation.y=-7.4+30*n,o[3].position.z=u+4*n,a[3].position.y=m-1.3-.65+9.5*n,o[4].rotation.y=-9.6+30*n,o[4].position.z=u+4*n,a[4].position.y=m-2.6+9.5*n,o[5].rotation.y=-11.8+30*n,o[5].position.z=u+4*n,a[5].position.y=m-2.6-.65+9.5*n,o[6].rotation.y=-14+30*n,o[6].position.z=u+4*n,a[6].position.y=m-3.9+9.5*n,o[7].rotation.y=-16.2+30*n,o[7].position.z=u+4*n,a[7].position.y=m-3.9-.65+9.5*n,o[8].rotation.y=-18.4+30*n,o[8].position.z=u+4*n,a[8].position.y=m-3.9-.65-.65+9.5*n,o[9].rotation.y=-20.6+30*n,o[9].position.z=u+4*n,a[9].position.y=m-3.9-1.3-.65+9.5*n,o[10].rotation.y=-22.8+30*n,o[10].position.z=u+4*n,a[10].position.y=m-3.9-2.6+9.5*n,X()},100);let D=0,N=0;function p(){D=window.pageYOffset||document.documentElement.scrollTop,N=window.pageXOffset||document.documentElement.scrollLeft,window.onscroll=function(){window.scrollTo(N,D)}}function V(){window.onscroll=function(){}}document.addEventListener("click",()=>{W==!0&&(a[l].material.map.isVideoTexture?c.paused?(c.currentTime=0,c.play().catch(e=>console.error("Video play error:",e)),i.to(o[l].rotation,{y:4.7,duration:.5}),p()):(c.pause(),c.currentTime=10,i.to(o[0].rotation,{y:R,duration:.5}),V()):l==0&&f.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),f.style.top=window.scrollY.toString()+"px",f.style.display="flex",f.style.transition="opacity 0.5s",p()):l==1&&w.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),w.style.top=window.scrollY.toString()+"px",w.style.display="flex",w.style.transition="opacity 0.5s",p()):l==2&&h.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),h.style.top=window.scrollY.toString()+"px",h.style.display="flex",h.style.transition="opacity 0.5s",p()):l==3&&S.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),S.style.top=window.scrollY.toString()+"px",S.style.display="flex",f.style.transition="opacity 0.5s",p()):l==4&&b.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),b.style.top=window.scrollY.toString()+"px",b.style.display="flex",b.style.transition="opacity 0.5s",p()):l==5&&B.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),B.style.top=window.scrollY.toString()+"px",B.style.display="flex",B.style.transition="opacity 0.5s",p()):l==6&&E.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),E.style.top=window.scrollY.toString()+"px",E.style.display="flex",E.style.transition="opacity 0.5s",p()):l==7&&L.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),L.style.top=window.scrollY.toString()+"px",L.style.display="flex",L.style.transition="opacity 0.5s",p()):l==8&&z.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),z.style.top=window.scrollY.toString()+"px",z.style.display="flex",z.style.transition="opacity 0.5s",p()):l==9&&T.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),T.style.top=window.scrollY.toString()+"px",T.style.display="flex",T.style.transition="opacity 0.5s",p()):l==10&&I.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),I.style.top=window.scrollY.toString()+"px",I.style.display="flex",I.style.transition="opacity 0.5s",p()):(i.to(o[l].rotation,{y:R,duration:.5}),f.style.display="none",w.style.display="none",h.style.display="none",S.style.display="none",b.style.display="none",B.style.display="none",E.style.display="none",L.style.display="none",z.style.display="none",T.style.display="none",I.style.display="none",V())),X()});window.addEventListener("scroll",()=>{d&&(R=o[l].rotation.y,c.paused&&f.style.display=="none"&&w.style.display=="none"&&h.style.display=="none"&&S.style.display=="none"&&b.style.display=="none"&&B.style.display=="none"&&E.style.display=="none"&&L.style.display=="none"&&z.style.display=="none"&&T.style.display=="none"&&I.style.display=="none"&&Ot(),window.scrollY>document.documentElement.scrollHeight-1e3&&k==!1?nt():window.scrollY<document.documentElement.scrollHeight-1e3&&k==!0&&ot())});
