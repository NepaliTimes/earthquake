import*as t from"https://cdn.skypack.dev/three@0.129.0/build/three.module.js";import{GLTFLoader as te}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/loaders/GLTFLoader.js";import{gsap as i}from"https://cdn.skypack.dev/gsap";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))f(r);new MutationObserver(r=>{for(const d of r)if(d.type==="childList")for(const C of d.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&f(C)}).observe(document,{childList:!0,subtree:!0});function x(r){const d={};return r.integrity&&(d.integrity=r.integrity),r.referrerPolicy&&(d.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?d.credentials="include":r.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function f(r){if(r.ep)return;r.ep=!0;const d=x(r);fetch(r.href,d)}})();window.onbeforeunload=function(){window.scrollTo(0,0)};const k=new t.PerspectiveCamera(10,window.innerWidth/window.innerHeight,.1,1e3);k.position.z=13;let v=document.getElementById("ending"),G=document.getElementById("logo");v.style.visibility="hidden";G.style.visibility="hidden";let O=!1;function oe(){v.style.visibility=="visible"&&function e(){(v.style.opacity-=.05)<0?(v.style.visibility="hidden",G.style.visibility="hidden"):requestAnimationFrame(e)}(),O=!1}function ne(){v.style.visibility=="hidden"&&function e(){var s=parseFloat(v.style.opacity);(s+=.05)>1||(v.style.opacity=s,requestAnimationFrame(e),v.style.visibility="visible",G.style.visibility="visible")}(),O=!0}let n=0,R=0,F={x:0,y:-.3,z:4},Y={x:.3,y:3.14},u=-2,p=4;const A=new t.Scene;let g;const ie=new te;let W=!1;const y=document.getElementById("vidA"),U=new t.VideoTexture(y),se=document.getElementById("imga"),le=new t.TextureLoader().load(se.src,()=>{t.Cache.clear()}),ae=document.getElementById("imgb"),re=new t.TextureLoader().load(ae.src,()=>{t.Cache.clear()}),de=document.getElementById("imgc"),ye=new t.TextureLoader().load(de.src,()=>{t.Cache.clear()}),ce=document.getElementById("imgd"),pe=new t.TextureLoader().load(ce.src,()=>{t.Cache.clear()}),ue=document.getElementById("imge"),me=new t.TextureLoader().load(ue.src,()=>{t.Cache.clear()}),fe=document.getElementById("imgf"),ge=new t.TextureLoader().load(fe.src,()=>{t.Cache.clear()}),we=document.getElementById("imgg"),xe=new t.TextureLoader().load(we.src,()=>{t.Cache.clear()}),he=document.getElementById("imgh"),be=new t.TextureLoader().load(he.src,()=>{t.Cache.clear()}),Be=document.getElementById("imgi"),Ee=new t.TextureLoader().load(Be.src,()=>{t.Cache.clear()}),Le=document.getElementById("imgj"),Te=new t.TextureLoader().load(Le.src,()=>{t.Cache.clear()}),ze=document.getElementById("imgk"),Ie=new t.TextureLoader().load(ze.src,()=>{t.Cache.clear()}),m=document.getElementById("text");console.log(m);m.style.display="none";m.style.top=0;const w=document.getElementById("text2");console.log(w);w.style.display="none";w.style.top=0;const h=document.getElementById("text3");h.style.display="none";h.style.top=0;const S=document.getElementById("text4");S.style.display="none";S.style.top=0;const b=document.getElementById("text5");b.style.display="none";b.style.top=0;const B=document.getElementById("text6");B.style.display="none";B.style.top=0;const E=document.getElementById("text7");E.style.display="none";E.style.top=0;const L=document.getElementById("text8");L.style.display="none";L.style.top=0;const T=document.getElementById("text9");T.style.display="none";T.style.top=0;const z=document.getElementById("text10");z.style.display="none";z.style.top=0;const I=document.getElementById("text11");I.style.display="none";I.style.top=0;y.addEventListener("loadeddata",()=>{y.play(),U.needsUpdate=!0});y.currentTime=10;function ve(e){const s=new t.Object3D;return s.scale.x=.5,s.scale.y=.5,s.scale.z=.5,s.rotation.y=e,s.position.z=p,s}function Se(e,s){const x=new t.BoxGeometry(1,1,1);s.isTexture?(s.wrapS=t.RepeatWrapping,s.wrapT=t.RepeatWrapping):s.isVideoTexture&&(x.applyMatrix4(new t.Matrix4().makeScale(-1,1,1)),s.minFilter=t.LinearFilter,s.magFilter=t.LinearFilter,s.format=t.RGBFormat);const f=new t.MeshBasicMaterial({map:s,side:t.FrontSide,toneMapped:!1});console.log(f);const r=new t.Mesh(x,f);return console.log(r),r.position.x=2,r.position.y=e,r.scale.x=.01,r.scale.y=.2,r.scale.z=.4,r}const J=new t.BufferGeometry,K=1e3,Q=new Float32Array(K*3);for(let e=0;e<K*3;e++)Q[e]=(Math.random()-.5)*(Math.random()*5);J.setAttribute("position",new t.BufferAttribute(Q,3));const Ae=new t.PointsMaterial({size:.005,color:"gray",transparent:!0,blending:t.AdditiveBlending}),q=new t.Points(J,Ae),Ce=new t.FontLoader,P=[],a=[],o=[],j=["11:56 25 April 2015","The Earthquake from Above","Langtang After 10 Years","Bhaktapur 2.0","Bungamati Builds Back","It Better Be Better Next Time","Loss of Soul and Soil","Structural Problems","Yes, Quakes can be Forecast","Disaster Journalism","Towering Monument to 2015"],Me=[.23,.3,.3,.195,.28,.35,.27,.25,.35,.35,.35],Fe=[-2,-3.1,-4.2,-5.3,-6.4,-7.5,-8.6,-9.7,-10.8,-11.9,-13],Ye=[le,re,ye,pe,me,ge,xe,be,Ee,Te,Ie];Ce.load("/earthquake/fonts/nueue.json",e=>{try{for(let s=0;s<j.length;s++){const x=new Se(Fe[s],Ye[s]),f=new ve(s+1);f.add(x),A.add(f),a.push(x),o.push(f),o.length>0&&o[0]&&o[0].add(q),console.log("Cube:",x),console.log("parent:",f);const r=new t.TextGeometry(j[s],{font:e,size:.05,height:.001});r.computeBoundingBox();const d=r.boundingBox.max.x-r.boundingBox.min.x,C=new t.MeshBasicMaterial({color:"black"}),M=new t.Mesh(r,C);M.rotation.y=1.65,M.position.set(3-d/2,-.65,Me[s]),M.scale.y=0,x.add(M),P.push(M)}}catch(s){console.error("ðŸ’¥ Error in font loader loop:",s)}});let l=0;function X(){for(var e=0;e<11;e++)4.125<=o[e].rotation.y&&o[e].rotation.y<=5.5?(l=e,y.paused&&m.style.display=="none"&&w.style.display=="none"&&h.style.display=="none"&&S.style.display=="none"&&b.style.display=="none"&&B.style.display=="none"&&E.style.display=="none"&&L.style.display=="none"&&T.style.display=="none"&&z.style.display=="none"&&I.style.display=="none"?(i.to(a[e].scale,{y:.8,duration:.5}),i.to(a[e].scale,{z:1.3,duration:.5}),i.to(a[e].rotation,{y:0,duration:.5}),i.to(a[e].position,{z:0,duration:.5}),i.to(a[e].position,{x:2,duration:.5}),i.to(P[e].scale,{y:2,duration:.5})):(i.to(a[e].scale,{y:1.4,duration:.5}),i.to(a[e].scale,{z:2,duration:.5}),i.to(a[e].rotation,{y:3.14,duration:.5}),i.to(a[e].position,{y:0,duration:.5}),i.to(a[e].position,{z:1,duration:.5}),i.to(a[e].position,{x:1,duration:.5}),i.to(P[e].scale,{y:0,duration:.5})),W=!0):(o[e].rotation.y<4.125||o[e].rotation.y>5.5)&&(i.to(a[e].scale,{y:.2,duration:.5}),i.to(a[e].scale,{z:.4,duration:.5}),i.to(a[e].rotation,{y:0,duration:.5}),i.to(a[e].position,{z:0,duration:.5}),i.to(a[e].position,{x:2,duration:.5}),i.to(P[e].scale,{y:0,duration:.5}));(o[l].rotation.y<4.125||o[l].rotation.y>5.5)&&(W=!1)}console.log(a[l]);ie.load("/earthquake/assetA.glb",function(e){g=e.scene,g.position.set(F.x,F.y,F.z),g.rotation.set(Y.x,Y.y,Y.z),g.scale.set(.04,.04,.04),A.add(g),console.log("Model loaded and initial rotation applied!"),t.Cache.clear()},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){console.error("An error occurred while loading the model",e)});const H=new t.WebGLRenderer({alpha:!0});H.setSize(window.innerWidth,window.innerHeight);document.getElementById("container3d").appendChild(H.domElement);const Pe=new t.AmbientLight(16777215,4);A.add(Pe);const Z=new t.DirectionalLight(8900346,5);Z.position.set(20,500,0);A.add(Z);const $=new t.DirectionalLight(16758465,3);$.position.set(0,200,0);A.add($);const ke=new t.Clock,ee=()=>{requestAnimationFrame(ee);const e=ke.getElapsedTime();q.rotation.y=-.1*e,q.rotation.x=-.1*e,y.readyState>=y.HAVE_CURRENT_DATA&&(U.needsUpdate=!0),H.render(A,k)};ee();window.addEventListener("resize",()=>{k.aspect=window.innerWidth/window.innerHeight,k.updateProjectionMatrix(),H.setSize(window.innerWidth,window.innerHeight)});const Oe=_.debounce(()=>{n=window.scrollY/document.body.clientHeight,g.rotation.y=Y.y+-1.8*Math.PI*n,g.rotation.x=Y.x+-.5*n,g.position.y=F.y+-.1*n,g.position.z=F.z+4*n,o[0].rotation.y=-.8+30*n,o[0].position.z=p+4*n,a[0].position.y=u+9.5*n,o[1].rotation.y=-3+30*n,o[1].position.z=p+4*n,a[1].position.y=u-.65+9.5*n,o[2].rotation.y=-5.2+30*n,o[2].position.z=p+4*n,a[2].position.y=u-1.3+9.5*n,o[3].rotation.y=-7.4+30*n,o[3].position.z=p+4*n,a[3].position.y=u-1.3-.65+9.5*n,o[4].rotation.y=-9.6+30*n,o[4].position.z=p+4*n,a[4].position.y=u-2.6+9.5*n,o[5].rotation.y=-11.8+30*n,o[5].position.z=p+4*n,a[5].position.y=u-2.6-.65+9.5*n,o[6].rotation.y=-14+30*n,o[6].position.z=p+4*n,a[6].position.y=u-3.9+9.5*n,o[7].rotation.y=-16.2+30*n,o[7].position.z=p+4*n,a[7].position.y=u-3.9-.65+9.5*n,o[8].rotation.y=-18.4+30*n,o[8].position.z=p+4*n,a[8].position.y=u-3.9-.65-.65+9.5*n,o[9].rotation.y=-20.6+30*n,o[9].position.z=p+4*n,a[9].position.y=u-3.9-1.3-.65+9.5*n,o[10].rotation.y=-22.8+30*n,o[10].position.z=p+4*n,a[10].position.y=u-3.9-2.6+9.5*n,X()},100);let D=0,N=0;function c(){D=window.pageYOffset||document.documentElement.scrollTop,N=window.pageXOffset||document.documentElement.scrollLeft,window.onscroll=function(){window.scrollTo(N,D)}}function V(){window.onscroll=function(){}}document.addEventListener("click",()=>{W==!0&&(a[l].material.map.isVideoTexture?y.paused?(y.currentTime=0,y.play().catch(e=>console.error("Video play error:",e)),i.to(o[l].rotation,{y:4.7,duration:.5}),c()):(y.pause(),y.currentTime=10,i.to(o[0].rotation,{y:R,duration:.5}),V()):l==0&&m.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),m.style.top=window.scrollY.toString()+"px",m.style.display="flex",m.style.transition="opacity 0.5s",c()):l==1&&w.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),w.style.top=window.scrollY.toString()+"px",w.style.display="flex",w.style.transition="opacity 0.5s",c()):l==2&&h.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),h.style.top=window.scrollY.toString()+"px",h.style.display="flex",h.style.transition="opacity 0.5s",c()):l==3&&S.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),S.style.top=window.scrollY.toString()+"px",S.style.display="flex",m.style.transition="opacity 0.5s",c()):l==4&&b.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),b.style.top=window.scrollY.toString()+"px",b.style.display="flex",b.style.transition="opacity 0.5s",c()):l==5&&B.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),B.style.top=window.scrollY.toString()+"px",B.style.display="flex",B.style.transition="opacity 0.5s",c()):l==6&&E.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),E.style.top=window.scrollY.toString()+"px",E.style.display="flex",E.style.transition="opacity 0.5s",c()):l==7&&L.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),L.style.top=window.scrollY.toString()+"px",L.style.display="flex",L.style.transition="opacity 0.5s",c()):l==8&&T.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),T.style.top=window.scrollY.toString()+"px",T.style.display="flex",T.style.transition="opacity 0.5s",c()):l==9&&z.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),z.style.top=window.scrollY.toString()+"px",z.style.display="flex",z.style.transition="opacity 0.5s",c()):l==10&&I.style.display=="none"?(i.to(o[l].rotation,{y:4.7,duration:.5}),I.style.top=window.scrollY.toString()+"px",I.style.display="flex",I.style.transition="opacity 0.5s",c()):(i.to(o[l].rotation,{y:R,duration:.5}),m.style.display="none",w.style.display="none",h.style.display="none",S.style.display="none",b.style.display="none",B.style.display="none",E.style.display="none",L.style.display="none",T.style.display="none",z.style.display="none",I.style.display="none",V())),X()});window.addEventListener("scroll",()=>{g&&(R=o[l].rotation.y,y.paused&&m.style.display=="none"&&w.style.display=="none"&&h.style.display=="none"&&S.style.display=="none"&&b.style.display=="none"&&B.style.display=="none"&&E.style.display=="none"&&L.style.display=="none"&&T.style.display=="none"&&z.style.display=="none"&&I.style.display=="none"&&Oe(),window.scrollY>document.documentElement.scrollHeight-1e3&&O==!1?ne():window.scrollY<document.documentElement.scrollHeight-1e3&&O==!0&&oe())});
